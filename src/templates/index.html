<!DOCTYPE html>
<html>
<head>
    <title>Sistema de Busca</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>Sistema de Busca</h1>
        <div class="row mt-4">
            <div class="col">
                <form id="searchForm">
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="endereco" class="form-label">Endereço</label>
                            <input type="text" class="form-control" id="endereco" name="DSC_ENDERECO_COMPLETO" placeholder="Digite o endereço...">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="bairro" class="form-label">Bairro</label>
                            <input type="text" class="form-control" id="bairro" name="DSC_BAIRRO" placeholder="Digite o bairro...">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="cep" class="form-label">CEP</label>
                            <input type="text" class="form-control" id="cep" name="NUM_CEP" placeholder="Digite o CEP...">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="nap" class="form-label">NAP</label>
                            <input type="text" class="form-control" id="nap" name="NAP" placeholder="Digite o NAP...">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="contrato" class="form-label">Contrato</label>
                            <input type="text" class="form-control" id="contrato" name="NUM_CONTRATO" placeholder="Digite o número do contrato...">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="status" class="form-label">Status</label>
                            <input type="text" class="form-control" id="status" name="STATUS" placeholder="Digite o status...">
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Buscar</button>
                </form>
            </div>
        </div>
        <div class="row mt-4">
            <div class="col">
                <div id="results"></div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('searchForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const query = {};
            const inputs = document.querySelectorAll('input[name]');
            inputs.forEach(input => {
                if (input.value.trim()) {
                    query[input.name] = input.value.trim();
                }
            });

            const response = await fetch('/search', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(query)
            });

            const results = await response.json();
            displayResults(results);
        });

        function displayResults(results) {
            const resultsDiv = document.getElementById('results');
            if (results.length === 0) {
                resultsDiv.innerHTML = '<p>Nenhum resultado encontrado</p>';
                return;
            }

            let table = '<table class="table">';
            
            // Cabeçalho da tabela
            table += '<thead><tr>';
            for (let key in results[0]) {
                table += `<th>${key}</th>`;
            }
            table += '</tr></thead>';
            
            // Dados
            table += '<tbody>';
            results.forEach(row => {
                table += '<tr>';
                for (let key in row) {
                    table += `<td>${row[key]}</td>`;
                }
                table += '</tr>';
            });
            table += '</tbody></table>';
            
            resultsDiv.innerHTML = table;
        }
    </script>
</body>
</html>